<h2>Responding to <%=@survey.job_title%>
	<span class="sponsor">sponsored by <%=link_to @survey.sponsor.name, organization_path(@survey.sponsor)%></span>
</h2>
<h3>Job Description</h3>
<p class="description_box"><%=@survey.description%></p>
<p>Report data as of <%=90.days.ago.to_date.to_s(:long_ordinal)%>.</p>
<%=flash_messages%>
<%= error_messages_for :participation %>
<% form_for @participation, :url => respond_survey_path(@survey), :builder => QuestionFormBuilder do |f|%>
	<ol id="questions">
		<% @survey.questions.each do |question|
			@response = *@participation.response[question.id] || question.responses.new %>
      <% f.fields_for @response, :index => question.id, :builder => QuestionFormBuilder do |q| %>
				<li>
					<%=q.form_field%>
					<% if question.qualify? then %>
						<div class="qualifications">
							<% if @response.qualifications.blank? %>
								<div class="field" style="display: none;">
									Comment: <%=q.text_field :qualifications %>
								</div>
								<span class="label"><a href="#">Add Comment</a></span>
							<% else %>
								<div class="field">
									Comment: <%=q.text_field :qualifications %>
								</div>
								<span class="label"><a href="#">Cancel</a></span>
							<% end %>
						</div>
					<% end %>
				<% end %>
			</li>
		<% end %>
		</ol>		
	<div class="response_submit"><input type="submit" value="Submit My Responses" /><span  id='cancel_section'> or <%=link_to "Cancel", survey_path(@survey), :id => 'cancel_link' %></span></div>
<% end %>
<script type="text/javascript">
function observeQualificationLinks() {
	$$('div.qualifications').each(function(elem) {
		links = elem.select('a')
		links.invoke('observe', 'click', function(e) {
			field = elem.select('div.field').first().toggle();
			e.target.innerHTML = e.target.innerHTML == 'Cancel' ? 'Add Comment' : 'Cancel';
			elem.select('input').first().value = "";
			e.stop();
		});
	});
}
</script>
<% content_for :initialize_js, "observeQualificationLinks();"%>
