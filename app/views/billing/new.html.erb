<% title "Billing Information for #{@survey.job_title}" %>
<% highlight_tab("surveys") %>
<div class="breadcrumbs">
  <%= image_tag 'step_1_inactive.gif' %>
  <%= image_tag 'step_2_inactive.gif' %>
  <%= image_tag 'step_3_inactive.gif' %>
  <%= image_tag 'step_4_active.gif' %>
</div>
<div id="step_container">
  <h3>Billing Information</h3>
  <p class="preview_text">
  Please enter your billing information below. The cost of a survey is <%=number_to_currency (@survey.price / 100)%> You may pay by credit card or request an invoice. You will not be billed until the survey completes successfully. 
  </p>
  <%=error_messages_for :invoice%>
  <%=flash_messages%>
  <% form_for @invoice, :url => survey_billing_path(@survey) do |f| %>
    <%=f.label :organization_name, required('Company Name') %>    
    <%=f.text_field :organization_name %>
    <%=f.label :contact_name, required('Contact Name') %>    
    <%=f.text_field :contact_name, :size => 13 %>
    <%=f.label :address_line_1, required("Address Line 1") %> 
    <%=f.text_field :address_line_1 %>
    <%=f.label :address_line_2, "Address Line 2" %> 
    <%=f.text_field :address_line_2 %>
    <% form_row do %>
      <% form_box do %>
        <%=f.label :city, required('City') %> 
        <%=f.text_field :city, :size => 13 %>
      <% end %>
      <% form_box do %>
        <%= f.label :state, required('State') %> 
        <%= f.select :state, AccountsHelper::STATE_ABBR, :include_blank => true %>
      <% end %>
      <% form_box do %>
        <%=f.label :zip_code, required('Zip') %> 
        <%=f.text_field :zip_code, :size => 7 %>
      <% end %>
    <% end %>    
    <% form_row do %>
      <% form_box do %>
        <%=f.label :phone, required("Phone") %> 
        <%=f.text_field :phone, :size => 15 %>
      <% end %>
      <% form_box do %>
        <%=f.label :phone_extension, 'Ext.' %> 
        <%=f.text_field :phone_extension, :size => 5 %>
      <% end %>   
    <% end %>
    <label>How Would You Like to be Billed?</label>
    <label></label>
    <%=f.radio_button :payment_type, 'credit' %> 
    <label for="invoice_payment_type_credit" style="display: inline;">By Credit Card</label>  
    <div id="credit_card" style="padding-left: 2em; display: none;">  
      <% fields_for @credit_card do |credit_card| %>
      <% form_row do %>
        <% form_box do %>
          <%= credit_card.label :first_name, required('First name') %>
          <%= credit_card.text_field :first_name, :size => 10 %>
        <% end %>     
        <% form_box do %>
          <%= credit_card.label :last_name, required('Last name') %>
          <%= credit_card.text_field :last_name, :size => 10 %>
        <% end %>               
      <% end %>        
      <% form_row do %>
        <% form_box do %>
          <%= credit_card.label :type, required('Type') %>
          <%= credit_card.select :type, [['Visa','visa'],['MasterCard','master'],['American Express','american_express'],['Discover','discover']], {:include_blank => true} %>
        <% end %> 
        <% form_box do %>
          <%= credit_card.label :number, required('Number') %>
          <%= credit_card.text_field :number, :size => 18 %>
        <% end %>
        <% form_box do %>
          <%= credit_card.label :verification_value, required('Verification value') %>
          <%= credit_card.text_field :verification_value, :size => 4 %>
        <% end %>                  
      <% end %>  
      <% form_row do %>
        <% form_box do %>
          <%= credit_card.label :year, required('Expiration Month/Year') %>
          <%= credit_card.select :month, 1..12, {:include_blank => true} %>&nbsp;
          <%= credit_card.select :year, Time.now.year..(Time.now.year + 10), {:include_blank => true} %>
        <% end %>   
        <% form_box do %>
        <% end %>                  
      <% end %>        
      <label></label>
      <p>Upon successful completion of the survey, your card will be charged and you will receive a reciept via email.</p>  
      <% end %>
    </div>    
    <label></label>
    <%=f.radio_button :payment_type, 'invoice' %>
    <label for="invoice_payment_type_invoice" style="display: inline;">By Invoice</label>
    <label></label>
    <div id="invoice" style="padding-left: 2em; display: none;">
      <p>Your purchase order number is: <%=@invoice.purchase_order_number%>. Upon successful completion of the survey, you will have the opportunity to view and print the invoice.</p>
    </div>
    <p>By submitting this information, you agree that you have read and understand the <%= link_to "legal disclaimer", home_path('about'), :target => '_blank' %> and you agree to pay <%=number_to_currency (@survey.price / 100)%> upon successful completion of the survey. If you have any questions about the billing process, please <%= link_to "contact us", home_path('contact'), :target => '_blank' %>.</p>
  <div class="submit_row">
      <input id="form_submit" type="submit" value="Next &ndash; Submit Billing Information" class="next" />
      <input type="button" value='Back &ndash; Preview Survey' class="previous" onClick ="parent.location='<%=preview_survey_questions_path(@survey)%>'" />
  </div>
  <% end %>
</div>
<script type="text/javascript">

function initializeObservers() {

  $('invoice_payment_type_credit').observe('click', selectCreditCard);
  $('invoice_payment_type_invoice').observe('click', selectInvoice);
  
  if($('invoice_payment_type_credit').checked)
    $('credit_card').show();
    
  if($('invoice_payment_type_invoice').checked)
    $('invoice').show();    
 
}

function selectCreditCard() {
  $('credit_card').blindDown({'duration': 0.5});
  $('invoice').blindUp({'duration': 0.5});
}

function selectInvoice() {
  $('invoice').blindDown({'duration': 0.5})
  $('credit_card').blindUp({'duration': 0.5})
}

</script>

<% content_for :initialize_js, "initializeObservers();"%>
